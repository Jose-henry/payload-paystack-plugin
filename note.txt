â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
paystack-payload-cms Plugin
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

OVERVIEW
  â€¢ Syncs your Payload collections (customers, plans, products) to Paystack  
    â€“ on create â†’ POST  
    â€“ on update â†’ PUT  
    â€“ on delete â†’ DELETE (or blacklist for unsupported resources)

  â€¢ Autoâ€scaffolds â€œread-onlyâ€ collections for  
    â€“ transactions  
    â€“ refunds  
    â€“ orders  
    â€“ subscriptions  
    which fetch directly from Paystack via afterOperation hooks.

  â€¢ Exposes an optional REST proxy at /api/paystack/rest  
    and a webhook endpoint at /api/paystack/webhook  

  â€¢ Adds a â€œView in Paystackâ€ link and â€œSkip Syncâ€ flag to every synced doc  

FEATURES & CAPABILITIES
  1. **Customer sync**  
     â€“ Create / update customer data  
     â€“ â€œBlacklistâ€ toggle in your Payload UI â†’ calls Paystackâ€™s 
       POST /customer/set_risk_action  
     â€“ You cannot DELETE a Paystack customer; plugin swallows 404s

  2. **Plan sync**  
     â€“ Create, update, delete real Paystack Plans  
     â€“ Stores `plan_code` in `paystackID` field

  3. **Product sync**  
     â€“ Create, update, delete Paystack Products (or map to Plans if you prefer)  
     â€“ Stores `product_code` (or `plan_code`) as `paystackID`

  4. **Read-only collections**  
     â€“ `transaction`, `refund`, `order`, `subscription`  
     â€“ No create/update/delete in Payloadâ€”only read via Paystack API  
     â€“ Maps fields like id, status, amount, currency, etc.

  5. **REST Proxy**  
     â€“ Optional `/api/paystack/rest` to call *any* Paystack endpoint  
     â€“ Freedom to build custom UIs or one-off calls

  6. **Webhooks**  
     â€“ `/api/paystack/webhook` verifies signatures and dispatches built-in handlers  
     â€“ Hook into events like payment.success, subscription.create, etc.

CONFIGURATION
  â€¢ In your `payload.config.ts` under `plugins: [ paystackPlugin({ â€¦ }) ]`:

    â€“ **paystackSecretKey** (required): your SK  
    â€“ **webhookSecret** (optional): to verify incoming webhooks  
    â€“ **rest**: `true` to enable REST proxy  
    â€“ **logs**: `true` for detailed console logs  
    â€“ **sync**: array of `{ collection, paystackResourceType, paystackResourceTypeSingular, fields }`  
    â€“ **resourceSlugs** (optional): override default slugs for read-only collections  

  â€¢ **Amount fields** in Payload should be stored in kobo (Ã—100)  
    â€“ e.g. Hook beforeValidate: `value => value * 100`  
    â€“ Paystack always expects the smallest currency unit

  â€¢ **Skip Sync** flag is automatically added to avoid infinite loops  
    â€“ Plugin sets `skipSync = true` while itâ€™s performing its own write

DOS & DONâ€™TS
  âœ”ï¸ **Do** map all your Payload fields to the correct Paystack properties  
  âœ”ï¸ **Do** use the â€œView in Paystackâ€ sidebar link to verify records  
  âœ”ï¸ **Do** enable `logs: true` while debugging flows  
  âœ”ï¸ **Do** override `resourceSlugs` if you already have those collections  

  âŒ **Donâ€™t** assume Paystack allows DELETE on everything  
     â€“ Customer and transaction deletion is not supported â†’ blacklist instead  
  âŒ **Donâ€™t** hand-roll your own webhook endpointâ€”use `/api/paystack/webhook`  
  âŒ **Donâ€™t** forget to guard your REST proxy if exposing to public  

LIMITATIONS & GOTCHAS
  â€“ **Customer deletion**: Paystack returns 404; plugin logs & swallows  
  â€“ **Rate limits**: Paystack API is rate-limited; plugin retries twice on network errors  
  â€“ **Data loss**: Reject external write operations on read-only collections  
  â€“ **Field name conflicts**: If you already have a `blacklisted` or `skipSync` field, plugin wonâ€™t double-inject  

TROUBLESHOOTING
  1. **Missing paystackID?**  
     â€“ Check your `sync` configâ€™s `fields` and ensure you map the correct property  
     â€“ Inspect console logs for the raw Paystack response  

  2. **Update not reflecting on Paystack?**  
     â€“ Ensure you changed a mapped field (plugin only sends changed props)  
     â€“ Confirm `skipSync` is false before your edit  

  3. **Read-only collection empty?**  
     â€“ Verify your `resourceSlugs` override matches the slug in your code  
     â€“ Trigger a `GET /api/<slug>` and inspect the raw API proxy response  

  4. **Webhook not firing?**  
     â€“ Confirm you configured your Paystack webhook URL + secret  
     â€“ Look at `/api/paystack/webhook` logs for signature verification errors  

FURTHER READING
  â€“ Paystack API docs: https://paystack.com/docs/api  
  â€“ Payload Hooks guide: https://payloadcms.com/docs/hooks  
  â€“ Example integration repo: (link to your project)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Happy coding! ğŸš€
